<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clima en Tiempo Real</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <!-- Moment.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <style>
        body{
            background: #0F2027;  /* fallback for old browsers */
    background: -webkit-linear-gradient(to right, #2C5364, #203A43, #0F2027);  /* Chrome 10-25, Safari 5.1-6 */
    background: linear-gradient(to right, #2C5364, #203A43, #0F2027); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        }
        .weather-icon {
            font-size: 50px;
        }
        .weather-card {
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            font-family: 'Open Sans', sans-serif;
            background: #16222A;  /* fallback for old browsers */
            background: -webkit-linear-gradient(to top, #3A6073, #16222A);  /* Chrome 10-25, Safari 5.1-6 */
            background: linear-gradient(to top, #3A6073, #16222A); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        }
        .form-control:focus {
            /* Estilos personalizados cuando el select está en foco */
            color:#3A6073;
            box-shadow: 0 0 0 0.2rem rgba(0, 4, 255, 0.185); /* Cambia el color del sombreado aquí */
            border-color: rgba(0, 23, 92, 0.25); /* Cambia el color del borde aquí si lo deseas */
        }
        option {
            color: #ffffff; /* Cambia el color del texto */
            background-color: #16222A;  /* fallback for old browsers */
            background-color: -webkit-linear-gradient(to top, #3A6073, #16222A);  /* Chrome 10-25, Safari 5.1-6 */
            background-color: linear-gradient(to top, #3A6073, #16222A); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        }
        option:hover {
            color: #ffffff; /* Cambia el color del texto al pasar el mouse */
            background-color: #021b42;  /* fallback for old browsers */
            background-color: -webkit-linear-gradient(to top, #6FB1FC, #4364F7, #0052D4);  /* Chrome 10-25, Safari 5.1-6 */
            background-color: linear-gradient(to top, #6FB1FC, #4364F7, #0052D4); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        }
        .temp {
            font-size: 27px;
        }
        .city {
            font-size: 25px;
            font-weight: bold;
        }
        .date-time {
            font-size: 16px;
            margin: 10px 0;
        }
        .details {
            font-size: 14px;
        }
        .icon-small {
            font-size: 20px;
        }
        .text-color {
            color: #c1bfbf;
        }
        .date, .time {
            display: block;
        }
        .extended-forecast {
            margin-top: 20px;
        }
        .forecast-card {
            margin-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
            background: #c31432;  /* fallback for old browsers */
            background: -webkit-linear-gradient(to bottom, #240b36, #c31432);  /* Chrome 10-25, Safari 5.1-6 */
            background: linear-gradient(to bottom, #240b36, #c31432); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

            border-radius: 5px;
            margin-right: 2px;
        }
        .air-quality-card{
            font-size: 17px;
            color: #9fdfff;
            font-family: 'Open Sans', sans-serif;
            background: #16222A;  /* fallback for old browsers */
            background: -webkit-linear-gradient(to top, #3A6073, #16222A);  /* Chrome 10-25, Safari 5.1-6 */
            background: linear-gradient(to top, #3A6073, #16222A); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

        }

        .aire-indice{
            color: #feffff;
            padding: 2px;
            margin:2px;
            border-radius: 2px;
            

        }
    </style>
</head>
<body>
    <div class="container text-center col-lg-3 col-md-8 mt-5">
        <h2 class="text-warning">Estado del Clima </h2>
        <div class="form-group ">
            <label for="city-select " class="text-white">Selecciona una ciudad:</label>
            <select id="city-select" class="form-control ">
                <option value="Managua">Managua</option>
                <option value="London">London</option>
                <option value="New York">New York</option>
                <option value="Tokyo">Tokyo</option>
                <option value="Sydney">Sydney</option>
                <option value="Paris">Paris</option>
                <option value="Berlin">Berlin</option>
                <option value="Moscow">Moscow</option>
                <option value="Beijing">Beijing</option>
                <option value="Mumbai">Mumbai</option>
                <option value="Cairo">Cairo</option>
                <option value="Buenos Aires">Buenos Aires</option>
                <option value="Rio de Janeiro">Rio de Janeiro</option>
                <option value="Cape Town">Cape Town</option>
                <option value="Lagos">Lagos</option>
                <option value="Nairobi">Nairobi</option>
                <option value="Mexico City">Mexico City</option>
                <option value="Los Angeles">Los Angeles</option>
                <option value="Chicago">Chicago</option>
                <option value="Toronto">Toronto</option>
                <option value="Vancouver">Vancouver</option>
                <option value="Sao Paulo">Sao Paulo</option>
                <option value="Hong Kong">Hong Kong</option>
                <option value="Bangkok">Bangkok</option>
                <option value="Seoul">Seoul</option>
                <option value="Singapore">Singapore</option>
                <option value="Dubai">Dubai</option>
                <option value="Istanbul">Istanbul</option>
                <option value="Jakarta">Jakarta</option>
                <option value="Lima">Lima</option>
                </select>
         </div>
                <div id="weather-card" class="weather-card mt-4">  </div>
               
                <div id="weather-alerts" class="col-lg-12 col-md-10  align-content-md-center"></div>
               
               
               
                </div>
                <div class="container text-center  align-content-center mt-4 mr-5 ">
                    <!--<div id="hourly-forecast" class="row extended-forecast"></div>
-->
                     <h3 class=" text-warning">Clima extendido </h3>
                     <div class="extended-forecast row col-md-12" id="extended-forecast"></div>
                    
                     <div class="container text-center col-lg-6 col-md-6">
                        <div id="air-quality" class="p-2 mt-5"></div>
                     </div>
                 </div>
                
                
                
                <script>
                    const apiKey = '3c743983734341f81c2486dcce043049';
                    const defaultCity = 'Managua';
                    const apiUrl = (city) => `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&lang=es&units=metric`;
                    const extendedApiUrl = (city) => `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&lang=es&units=metric`;
                
                    const weatherIcons = {
                        'Clear': 'fa-sun text-warning',
                        'Clouds': 'fa-cloud text-white',
                        'Rain': 'fa-cloud-showers-heavy text-white',
                        'Drizzle': 'fa-cloud-rain text-white',
                        'Thunderstorm': 'fa-bolt text-white',
                        'Snow': 'fa-snowflake text-white',
                        'Mist': 'fa-smog text-white',
                        'Smoke': 'fa-smog text-white',
                        'Haze': 'fa-smog text-white',
                        'Dust': 'fa-smog text-white',
                        'Fog': 'fa-smog text-white',
                        'Sand': 'fa-smog text-white',
                        'Ash': 'fa-smog text-white',
                        'Squall': 'fa-smog text-white',
                        'Tornado': 'fa-tornado text-white'
                    };
                
                    let currentCity = defaultCity;
                    let timezoneOffset = 0;
                
                    function updateWeather(city) {
                        fetch(apiUrl(city))
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('No se pudo obtener el clima');
                                }
                                return response.json();
                            })
                            .then(data => {
                                const weatherCard = document.getElementById('weather-card');
                                const iconClass = weatherIcons[data.weather[0].main] || 'fa-question';
                                currentCity = city;
                                timezoneOffset = data.timezone;
                                const now = moment.utc().add(timezoneOffset, 'seconds');
                                const date = now.format('DD/MM/YYYY');
                                const time = now.format('h:mm:ss A');
                                const windSpeedKmh = (data.wind.speed * 3.6).toFixed(2); // Convert from m/s to km/h
                                const rainProbability = data.clouds.all ? data.clouds.all : 0; // Usar la nubosidad como probabilidad de precipitaciones
                
                                weatherCard.innerHTML = `
                                    <div class="row">
                                        <div class="col-6 city text-warning">${data.name}</div>
                                        <div class="col-6 temp text-white">${data.main.temp}°C</div>
                                    </div>
                                    <div class="date-time">
                                        <span class="date text-white">${date}</span>
                                        <span class="time text-white">${time}</span>
                                    </div>
                                    <div class="details text-color">
                                        <i class="fas ${iconClass} weather-icon"></i>
                                        <p>Descripción: ${data.weather[0].description}</p>
                                        <p><i class="fas fa-tint icon-small"></i> Humedad: ${data.main.humidity}%</p>
                                        <p><i class="fas fa-wind icon-small"></i> Viento: ${windSpeedKmh} km/h</p>
                                        <p><i class="fas fa-umbrella icon-small"></i> Prob. de precipitaciones: ${rainProbability}%</p>
                                    </div>
                                `;
                                updateExtendedForecast(city); // Update extended forecast when weather is updated
                                updateHourlyForecast(city); // Update hourly forecast
                                updateWeatherAlerts(city); // Update weather alerts
                                updateAirQuality(data.coord.lat, data.coord.lon); // Update air quality with lat/lon
                            })
                            .catch(error => {
                                console.error('Error al obtener el clima:', error);
                            });
                    }
                
                    function updateExtendedForecast(city) {
    fetch(extendedApiUrl(city))
        .then(response => {
            if (!response.ok) {
                throw new Error('No se pudo obtener el pronóstico extendido');
            }
            return response.json();
        })
        .then(data => {
            const extendedForecastContainer = document.getElementById('extended-forecast');
            extendedForecastContainer.innerHTML = ''; // Clear previous forecast data

            // Create a row to contain the forecast cards
            const forecastRow = document.createElement('div');
            forecastRow.classList.add('row');

            // Get the current date and ensure we start from the next day
            const now = moment.utc().add(timezoneOffset, 'seconds').endOf('day');
            let currentDay = now.clone().add(1, 'day').startOf('day');

            // Collect forecast data for the next 7 days
            const dailyForecasts = [];

            for (const forecast of data.list) {
                const forecastTime = moment.unix(forecast.dt).utc().add(timezoneOffset, 'seconds');
                if (forecastTime.isSameOrAfter(currentDay, 'day')) {
                    // Push the forecast if it's for the new day
                    dailyForecasts.push(forecast);

                    // Move to the next day
                    currentDay.add(1, 'day').startOf('day');

                    // Stop collecting after 7 days
                    if (dailyForecasts.length >= 7) break;
                }
            }

            // Display forecast for the next 7 days starting from tomorrow
            dailyForecasts.forEach(forecast => {
                const forecastDate = moment.unix(forecast.dt).utc().add(timezoneOffset, 'seconds').format('dddd DD/MM');
                const forecastTemp = forecast.main.temp;
                const forecastIcon = weatherIcons[forecast.weather[0].main] || 'fa-question';

                // Create forecast card
                const forecastCol = document.createElement('div');
                forecastCol.classList.add('col-lg-3', 'col-md-6', 'col-sm-6', 'mb-2'); // Responsive columns
                const forecastCard = document.createElement('div');
                forecastCard.classList.add('card', 'forecast-card', 'p-3', 'bg-dark', 'text-white');
                forecastCard.innerHTML = `
                    <div class="text-warning">${forecastDate}</div>
                    <div class="weather-icon my-2"><i class="fas ${forecastIcon}"></i></div>
                    <div class="temp text-white">${forecastTemp}°C</div>
                `;
                forecastCol.appendChild(forecastCard);
                forecastRow.appendChild(forecastCol);
            });

            // Append the row to the extended forecast container
            extendedForecastContainer.appendChild(forecastRow);
        })
        .catch(error => {
            console.error('Error al obtener el pronóstico extendido:', error);
        });
}


                    document.getElementById('city-select').addEventListener('change', (event) => {
                        updateWeather(event.target.value);
                    });
                
                    function updateTime() {
                        const weatherCard = document.getElementById('weather-card');
                        if (weatherCard.innerHTML) {
                            const now = moment.utc().add(timezoneOffset, 'seconds');
                            const date = now.format('DD/MM/YYYY');
                            const time = now.format('h:mm:ss A');
                            const dateElement = weatherCard.querySelector('.date');
                            const timeElement = weatherCard.querySelector('.time');
                            dateElement.textContent = date;
                            timeElement.textContent = time;
                        }
                    }
                
                    updateWeather(defaultCity);
                    setInterval(updateTime, 1000); // Update time every second
                
                    const hourlyApiUrl = (city) => `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&lang=es&units=metric`;
                
                    function updateHourlyForecast(city) {
                        fetch(hourlyApiUrl(city))
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('No se pudo obtener el pronóstico por hora');
                                }
                                return response.json();
                            })
                            .then(data => {
                                const hourlyForecastContainer = document.getElementById('hourly-forecast');
                                hourlyForecastContainer.innerHTML = '';
                
                                data.list.slice(0, 24).forEach(forecast => { // Mostrar solo las próximas 24 horas
                                    const forecastTime = moment.unix(forecast.dt).utc().add(timezoneOffset, 'seconds').format('HH:mm');
                                    const forecastTemp = forecast.main.temp;
                                    const forecastIcon = weatherIcons[forecast.weather[0].main] || 'fa-question';
                
                                    const forecastCard = document.createElement('div');
                                    forecastCard.classList.add('col', 'forecast-card');
                                    forecastCard.innerHTML = `
                                        <div class="text-color">${forecastTime}</div>
                                        <div class="weather-icon"><i class="fas ${forecastIcon}"></i></div>
                                        <div class="temp text-white">${forecastTemp}°C</div>
                                    `;
                                    hourlyForecastContainer.appendChild(forecastCard);
                                });
                            })
                            .catch(error => {
                                console.error('Error al obtener el pronóstico por hora:', error);
                            });
                    }
                
                    const alertsApiUrl = (lat, lon) => `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=current,minutely,hourly,daily&appid=${apiKey}&lang=es`;
                
                    function updateWeatherAlerts(city) {
                        fetch(apiUrl(city))
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('No se pudo obtener las coordenadas para las alertas');
                                }
                                return response.json();
                            })
                            .then(data => {
                                const lat = data.coord.lat;
                                const lon = data.coord.lon;
                                fetch(alertsApiUrl(lat, lon))
                                    .then(response => response.json())
                                    .then(alertData => {
                                        const alertsContainer = document.getElementById('weather-alerts');
                                        alertsContainer.innerHTML = '';
                
                                        if (alertData.alerts && alertData.alerts.length > 0) {
                                            alertData.alerts.forEach(alert => {
                                                const alertCard = document.createElement('div');
                                                alertCard.classList.add('alert', 'alert-warning');
                                                alertCard.innerHTML = `
                                                    <strong>${alert.event}</strong>: ${alert.description}
                                                    <br><small>${new Date(alert.start * 1000).toLocaleString()} - ${new Date(alert.end * 1000).toLocaleString()}</small>
                                                `;
                                                alertsContainer.appendChild(alertCard);
                                            });
                                        } else {
                                            alertsContainer.innerHTML = '<div class="alert alert-warning text-secondary">No hay alertas meteorológicas.</div>';
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error al obtener las alertas meteorológicas:', error);
                                    });
                            })
                            .catch(error => {
                                console.error('Error al obtener las coordenadas:', error);
                            });
                    }
                
                    const airQualityApiUrl = (lat, lon) => `https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`;

function getComponentIcon(component) {
    switch (component) {
        case 'co': return 'fa-smog';
        case 'no': return 'fa-car-crash';
        case 'no2': return 'fa-car';
        case 'o3': return 'fa-cloud';
        case 'so2': return 'fa-industry';
        case 'pm2_5': return 'fa-dust';
        case 'pm10': return 'fa-wind';
        case 'nh3': return 'fa-flask';
        default: return 'fa-question';
    }
}

function updateAirQuality(lat, lon) {
    fetch(airQualityApiUrl(lat, lon))
        .then(response => {
            if (!response.ok) {
                throw new Error('No se pudo obtener la calidad del aire');
            }
            return response.json();
        })
        .then(data => {
            const airQualityContainer = document.getElementById('air-quality');
            airQualityContainer.innerHTML = '';

            const airQualityIndex = data.list[0].main.aqi;
            const airQualityDescription = getAirQualityDescription(airQualityIndex);

            const components = data.list[0].components; // Obtiene los componentes de la calidad del aire

            const airQualityCard = document.createElement('div');
            airQualityCard.classList.add('air-quality-card', 'p-3', 'bg-dark', 'text-white');
            airQualityCard.innerHTML = `
                <div class="text-warning">Índice de calidad del aire:<br>   <span class="aire-indice badge-secondary border border-2 border-bottom">${airQualityIndex}</span> </div>
                <div class="text-warning">Calidad: <br> <span class="aire-indice badge-secondary border border-2 border-bottom">${airQualityDescription}</span> </div>
                <div class="text-warning">Componentes:</div>
            `;
        
            // Agregar cada componente al card
            const componentsRow = document.createElement('div');
            componentsRow.classList.add('row');

            for (const component in components) {
                const componentCol = document.createElement('div');
                componentCol.classList.add('col-6', 'col-md-4', 'col-lg-3', 'mb-3');

                const badge = document.createElement('span');
                badge.classList.add('badge', 'bg-secondary', 'd-flex', 'align-items-center');
                badge.innerHTML = `
                    <i class="fas ${getComponentIcon(component)} me-2"></i> 
                    ${component.toUpperCase()}: ${components[component]}
                `;

                componentCol.appendChild(badge);
                componentsRow.appendChild(componentCol);
            }

            airQualityCard.appendChild(componentsRow);
            airQualityContainer.appendChild(airQualityCard);
        })
        .catch(error => {
            console.error('Error al obtener la calidad del aire:', error);
        });
}

function getAirQualityDescription(index) {
    switch(index) {
        case 1: return 'Buena';
        case 2: return 'Moderada';
        case 3: return 'No saludable para grupos sensibles';
        case 4: return 'No saludable';
        case 5: return 'Muy no saludable';
        case 6: return 'Peligrosa';
        default: return 'Desconocida';
    }
}

// Llama a estas funciones en updateWeather o cuando se necesite
updateAirQuality(defaultCity);

                </script>
                
                
<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

